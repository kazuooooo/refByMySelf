{"version":3,"sources":["src/reactive.ts","src/index.ts"],"names":[],"mappings":"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","file":"src.f10117fe.js","sourceRoot":"..","sourcesContent":["const targetMap = new WeakMap()\n\ntype Effect = () => void\nlet activeEffect: Effect | null = null\n\nexport const effect = (e: Effect) => {\n  activeEffect = e\n  e()\n  activeEffect = null\n}\n\nconst track = (target: Object, key: string | symbol) => {\n  if (activeEffect) {\n    let depsMap = targetMap.get(target)\n    if (!depsMap) {\n      targetMap.set(target, (depsMap = new Map()))\n    }\n\n    let dep = depsMap.get(key)\n    if (!dep) {\n      depsMap.set(key, (dep = new Set<Effect>()))\n    }\n    console.log(\"tracked\", target, key, activeEffect)\n    dep.add(activeEffect)\n  }\n}\n\nconst trigger = (target: Object, key: string | symbol) => {\n  const dep = targetMap.get(target)?.get(key)\n  if (!dep) {\n    return\n  }\n  console.log(\"trigger\", target, key)\n  dep.forEach((e: Effect) => e())\n}\n\nexport const reactive = <T extends object>(target: T) => {\n  return new Proxy(target, {\n    get(target, key, receiver) {\n      const result = Reflect.get(target, key, receiver)\n      track(target, key)\n      return result\n    },\n    set(target, key, value, receiver) {\n      const oldValue = Reflect.get(target, key, receiver)\n      const result = Reflect.set(target, key, value, receiver)\n      if (result && oldValue !== value) {\n        trigger(target, key)\n      }\n      return result\n    },\n  })\n}\n\ntype RefValue = string | number\nexport type Ref<T extends RefValue> = { value: T }\nexport const ref = <T extends RefValue>(raw?: T) => {\n  const r = {\n    get value() {\n      track(r, \"value\")\n      return raw\n    },\n    set value(newVal) {\n      if (raw !== newVal) {\n        raw = newVal\n        trigger(r, \"value\")\n      }\n    },\n  }\n  return r\n}\n\nexport const computed = (getter: () => RefValue) => {\n  let result = ref()\n  effect(() => (result.value = getter()))\n  return result as Ref<RefValue>\n}\nexport {}\n","import { effect, reactive, ref, computed } from \"./reactive\"\nconst product = reactive({ price: 5, quantity: 2 })\nlet salePrice = computed(() => product.price * 0.9)\nlet total = computed(() => salePrice.value * product.quantity)\n\n\n// salePriceには変更されるが、salePriceに依存するtotalの値は変更されない\nproduct.price = 10\nconsole.log(\n  `total (should be 18) = ${total} salePrice (should be 9) = ${salePrice.value}`\n  // total (should be 18) = 0 salePrice (should be 9) = 9\n)\n\nexport {}\n"]}